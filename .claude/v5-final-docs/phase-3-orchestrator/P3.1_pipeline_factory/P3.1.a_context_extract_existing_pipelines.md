# Task ID: P3.1.a - Extract Existing Pipeline Implementations

**Sub-phase:** P3.1
**Scope:** Phase 3 - Orchestrator & Pipelines only
**Task type:** context-extraction

## Purpose

Map all existing pipeline implementations (legacy classes and Phase 2 adapters) to understand what the factory needs to create.

## Context to load before running this task

- `.claude/v5-final-docs/phase-2-state-management/P2.3_pipeline_protocols/P2.3.index.md`
- `.claude/v5-final-docs/phase-2-state-management/P2.4_legacy_adapters/P2.4.index.md`
- `fusion/core/routing.py` (lines 1-100, class definition)
- `fusion/core/spectrum_assignment.py` (lines 1-100, class definition)

## Outputs

### 1. Legacy Implementation Inventory

Create a detailed inventory of legacy implementations:

```markdown
## Routing Implementations

### fusion/core/routing.py - Routing class
- Entry point: `get_route(source, destination, request_bandwidth)`
- Dependencies: engine_props, sdn_props, route_props
- Output: Updates route_props with paths_matrix, weights_list, modulation_formats_matrix
- Algorithm registry: k_shortest_path, congestion_aware, fragmentation_aware, nli_aware, xt_aware

### Routing Algorithms (via registry)
- `fusion/modules/routing/k_shortest_path.py`
- `fusion/modules/routing/congestion_aware.py`
- [list all registered algorithms]

## Spectrum Implementations

### fusion/core/spectrum_assignment.py - SpectrumAssignment class
- Entry point: `get_spectrum(path, modulation, bandwidth)`
- Dependencies: engine_props, sdn_props, spectrum_props, route_props
- Output: Updates spectrum_props with start_slot, end_slot, core_number, etc.
- Strategies: first_fit, best_fit (via helpers)

## Grooming Implementations

### fusion/core/grooming.py - Grooming class
- Entry point: `handle_grooming()` (called from SDNController)
- Dependencies: engine_props, sdn_props
- Output: Updates sdn_props with grooming results
- Types: end_to_end, partial

## SNR Implementations

### fusion/core/snr_measurements.py - SnrMeasurements class
- Entry point: `check_snr(path, spectrum_info)`
- Dependencies: engine_props, sdn_props, spectrum_props, snr_props
- Output: SNR validation result (pass/fail)
- Calculation methods: standard, xt_aware, external_file

## Slicing Implementations

### fusion/core/slicing.py - LightPathSlicingManager class
- Entry point: `slice_request(request, path, bandwidth)`
- Dependencies: engine_props, sdn_props
- Output: Multiple lightpath allocations
```

### 2. Phase 2 Adapter Summary

Document adapters created in Phase 2:

```markdown
## Adapters from P2.4

| Adapter | Protocol | Legacy Class | Status |
|---------|----------|--------------|--------|
| RoutingAdapter | RoutingPipeline | Routing | P2.4.b |
| SpectrumAdapter | SpectrumPipeline | SpectrumAssignment | P2.4.c |
| GroomingAdapter | GroomingPipeline | Grooming | P2.4.d |
| SNRAdapter | SNRPipeline | SnrMeasurements | P2.4.d |

### Adapter Import Paths
- `from fusion.core.adapters.routing_adapter import RoutingAdapter`
- `from fusion.core.adapters.spectrum_adapter import SpectrumAdapter`
- `from fusion.core.adapters.grooming_adapter import GroomingAdapter`
- `from fusion.core.adapters.snr_adapter import SNRAdapter`
```

### 3. New Implementations Needed

Identify new pipeline implementations required for Phase 3:

```markdown
## New Pipelines for Phase 3

### ProtectedRoutingPipeline
- Trigger: `route_method == "1plus1_protection"`
- Location: `fusion/pipelines/routing_pipeline.py`
- Reason: 1+1 protection requires disjoint path logic not in legacy

### StandardSlicingPipeline
- Trigger: `slicing_enabled == True`
- Location: `fusion/pipelines/slicing_pipeline.py`
- Reason: Slicing needs orchestrator-friendly interface

### Optional: BestFitSpectrumPipeline
- Trigger: `allocation_method == "best_fit"` (if new impl desired)
- Location: `fusion/pipelines/spectrum_pipeline.py`
- Status: Can defer to adapter for now
```

### 4. Configuration Field Mapping

Map config fields to pipeline selection:

```markdown
## SimulationConfig Fields for Pipeline Selection

### Routing
- `route_method: str` - Algorithm name
- `k_paths: int` - Number of candidate paths
- `max_link_length: float | None` - Link constraint
- `use_protection: bool` - Enable 1+1 protection

### Spectrum
- `allocation_method: str` - Assignment strategy
- `num_cores: int` - Multi-core support
- `bands_enabled: list[str]` - Multi-band support

### Grooming
- `grooming_enabled: bool` - Enable grooming
- `grooming_type: str` - Grooming strategy

### SNR
- `snr_enabled: bool` - Enable SNR validation
- `snr_type: str` - Calculation method
- `xt_threshold: float | None` - Crosstalk threshold

### Slicing
- `slicing_enabled: bool` - Enable slicing
- `max_slices: int` - Maximum slices per request
```

## Verification

After extraction, verify:
- [ ] All legacy classes documented with entry points
- [ ] All Phase 2 adapters listed with import paths
- [ ] Configuration fields mapped to pipeline selection
- [ ] New pipeline requirements identified

## Next Task

After completing this extraction, proceed to `P3.1.b_design_pipeline_set.md`.
