# P3.1 Pipeline Factory - Index

## Sub-phase Overview

**Goal**: Create `PipelineFactory` that produces pipelines based on `SimulationConfig`, and `PipelineSet` to hold all pipeline references.

**Output**:
- `fusion/core/pipeline_factory.py`
- `fusion/pipelines/__init__.py`

**Dependencies**:
- Phase 1 complete (SimulationConfig, result objects)
- Phase 2 complete (Pipeline protocols, legacy adapters)

## Objectives

1. Define `PipelineSet` dataclass to hold pipeline references
2. Create `PipelineFactory` with static factory methods
3. Factory selects between legacy adapters and new pipelines based on config
4. Factory is stateless - only creates objects, does not store state

## Constraints

- **Purely additive** - No changes to existing files
- **Stateless factory** - Static methods only, no instance state
- **Config-driven selection** - Pipeline choice based on `SimulationConfig`
- **Optional pipelines** - Grooming, SNR, Slicing may be `None` if disabled
- All code must pass `mypy --strict` and `ruff check`

## Micro-tasks

Execute in alphabetical order:

| Task ID | File | Type | Description |
|---------|------|------|-------------|
| P3.1.a | `P3.1.a_context_extract_existing_pipelines.md` | context-extraction | Map existing pipeline implementations |
| P3.1.b | `P3.1.b_design_pipeline_set.md` | design | Design PipelineSet dataclass |
| P3.1.c | `P3.1.c_implement_pipeline_factory.md` | refactor-plan | Implement PipelineFactory |
| P3.1.d | `P3.1.d_verify_factory.md` | verification-plan | Unit tests and validation |
| P3.1.e | `P3.1.e_routing_strategy_pattern.md` | design (gap fill) | Routing strategy interface and selection |

## Shared Context

- `P3.1.shared_context_pipeline_selection_rules.md` - Rules for selecting adapters vs new pipelines

## PipelineSet Overview

```python
@dataclass
class PipelineSet:
    """Container for all pipelines used by orchestrator."""
    routing: RoutingPipeline
    spectrum: SpectrumPipeline
    grooming: GroomingPipeline | None = None
    snr: SNRPipeline | None = None
    slicing: SlicingPipeline | None = None
```

## PipelineFactory Overview

```python
class PipelineFactory:
    """Factory for creating pipelines based on configuration."""

    @staticmethod
    def create_routing(config: SimulationConfig) -> RoutingPipeline:
        ...

    @staticmethod
    def create_spectrum(config: SimulationConfig) -> SpectrumPipeline:
        ...

    @staticmethod
    def create_grooming(config: SimulationConfig) -> GroomingPipeline | None:
        ...

    @staticmethod
    def create_snr(config: SimulationConfig) -> SNRPipeline | None:
        ...

    @staticmethod
    def create_slicing(config: SimulationConfig) -> SlicingPipeline | None:
        ...

    @classmethod
    def create_pipeline_set(cls, config: SimulationConfig) -> PipelineSet:
        ...

    @classmethod
    def create_orchestrator(cls, config: SimulationConfig) -> SDNOrchestrator:
        ...
```

## File Structure

```
fusion/
├── core/
│   └── pipeline_factory.py    # PipelineFactory, PipelineSet
└── pipelines/
    └── __init__.py            # Package initialization
```

## Pipeline Selection Rules

| Pipeline | Default | Condition for New Implementation |
|----------|---------|----------------------------------|
| Routing | `RoutingAdapter` | `route_method == "1plus1_protection"` |
| Spectrum | `SpectrumAdapter` | `allocation_method == "best_fit"` |
| Grooming | `GroomingAdapter` | `grooming_enabled == True` |
| SNR | `SNRAdapter` | `snr_enabled == True` |
| Slicing | `StandardSlicingPipeline` | `slicing_enabled == True` |

## Exit Criteria

- [ ] `fusion/core/pipeline_factory.py` created
- [ ] `fusion/pipelines/__init__.py` created
- [ ] `PipelineSet` dataclass defined with all pipeline types
- [ ] `PipelineFactory` creates correct pipelines for all config combinations
- [ ] `mypy --strict` passes
- [ ] `ruff check` passes
- [ ] Unit tests cover all factory methods

## Next Sub-phase

After P3.1 completes, proceed to [P3.2 SDN Orchestrator](../P3.2_sdn_orchestrator/P3.2.index.md).
