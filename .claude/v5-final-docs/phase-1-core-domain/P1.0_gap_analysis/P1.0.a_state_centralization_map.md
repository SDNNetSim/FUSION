# P1.0.a State Centralization Map

## Purpose

This document provides a complete field-by-field mapping from all legacy Props classes to their destinations in the new domain model. Every field must have an explicit destination.

## Destination Categories

| Destination | Description | Phase |
|-------------|-------------|-------|
| `SimulationConfig` | Immutable configuration (frozen dataclass) | P1.1 |
| `Request` | Per-request state (mutable dataclass) | P1.2 |
| `Lightpath` | Per-lightpath state (mutable dataclass) | P1.3 |
| `RouteResult` | Routing computation result (frozen) | P1.4 |
| `SpectrumResult` | Spectrum assignment result (frozen) | P1.4 |
| `GroomingResult` | Grooming attempt result (frozen) | P1.4 |
| `SlicingResult` | Slicing attempt result (frozen) | P1.4 |
| `SNRResult` | SNR validation result (frozen) | P1.4 |
| `AllocationResult` | Final allocation outcome (frozen) | P1.4 |
| `ProtectionResult` | Protection establishment result (frozen) | P1.4 |
| `StatsCollector` | Statistics aggregation | P1.5 |
| `NetworkState` | Network-wide mutable state | P2 |
| **DELETE** | Field no longer needed | - |
| **COMPUTED** | Derived at runtime, not stored | - |

---

## 1. RoutingProps Field Mapping

Source: `fusion/core/properties.py` lines 29-71

| Legacy Field | Type | Destination | Rationale |
|-------------|------|-------------|-----------|
| `paths_matrix` | `list[Any]` | `RouteResult.paths` | Computed paths |
| `modulation_formats_matrix` | `list[list[str]]` | `RouteResult.modulations` | Valid mods per path |
| `weights_list` | `list[float]` | `RouteResult.weights_km` | Path lengths |
| `path_index_list` | `list[int]` | `RouteResult.metadata` | Path indices |
| `backup_paths_matrix` | `list[list[int]\|None]` | `RouteResult.backup_paths` | Protection paths |
| `backup_modulation_formats_matrix` | `list[list[str]]` | `RouteResult.backup_modulations` | Backup mods |
| `input_power` | `float` | `SimulationConfig.snr.input_power` | Physical constant |
| `frequency_spacing` | `float` | `SimulationConfig.snr.frequency_spacing` | Physical constant |
| `mci_worst` | `float` | `SimulationConfig.snr.mci_worst` | Physical constant |
| `span_length` | `float` | `SimulationConfig.topology.span_length` | Network param |
| `max_link_length` | `float\|None` | `SimulationConfig.topology.max_link_length` | Constraint |
| `max_span` | `int\|None` | `SimulationConfig.topology.max_span` | Constraint |
| `connection_index` | `int\|None` | **DELETE** | Temporary state |
| `path_index` | `int\|None` | `Request.selected_path_index` | Per-request |

---

## 2. SpectrumProps Field Mapping

Source: `fusion/core/properties.py` lines 73-122

| Legacy Field | Type | Destination | Rationale |
|-------------|------|-------------|-----------|
| `path_list` | `list[int]\|None` | `Request.path_list` | Selected path |
| `backup_path` | `list[int]\|None` | `Request.backup_path` | Protection path |
| `slots_needed` | `int\|None` | `SpectrumResult.slots_needed` | Computed |
| `modulation` | `str\|None` | `SpectrumResult.modulation` | Selected mod |
| `forced_core` | `int\|None` | **COMPUTED** | RL override |
| `core_number` | `int\|None` | `SpectrumResult.core` | Selected core |
| `cores_matrix` | `dict\|None` | `NetworkState.spectrum` | Network state |
| `reverse_cores_matrix` | `dict\|None` | `NetworkState.spectrum` | Network state |
| `is_free` | `bool` | `SpectrumResult.is_free` | Result flag |
| `forced_index` | `int\|None` | **COMPUTED** | RL override |
| `start_slot` | `int\|None` | `SpectrumResult.start_slot` | Allocated slot |
| `end_slot` | `int\|None` | `SpectrumResult.end_slot` | Allocated slot |
| `forced_band` | `str\|None` | **COMPUTED** | RL override |
| `current_band` | `str\|None` | `SpectrumResult.band` | Selected band |
| `crosstalk_cost` | `float\|None` | `SpectrumResult.xt_cost` | Quality metric |
| `lightpath_id` | `int\|None` | `Lightpath.lightpath_id` | LP identifier |
| `lightpath_bandwidth` | `float\|None` | `Lightpath.total_bandwidth_gbps` | LP capacity |
| `slicing_flag` | `bool` | `Request.is_sliced` | Per-request |

---

## 3. SNRProps Field Mapping

Source: `fusion/core/properties.py` lines 125-295

| Legacy Field | Type | Destination | Rationale |
|-------------|------|-------------|-----------|
| `light_frequency` | `float` | `SimulationConfig.snr.light_frequency` | Constant |
| `planck_constant` | `float` | `SimulationConfig.snr.planck_constant` | Constant |
| `request_bit_rate` | `float` | `SimulationConfig.snr.request_bit_rate` | Default |
| `request_snr` | `float` | `SimulationConfig.snr.request_snr` | Default |
| `noise_spectral_density` | `float` | `SimulationConfig.snr.noise_spectral_density` | Default |
| `nsp` | `dict[str,float]` | `SimulationConfig.snr.nsp_per_band` | Band params |
| `req_snr` | `dict[str,float]` | `SimulationConfig.snr.snr_thresholds` | Mod thresholds |
| `center_frequency` | `float\|None` | `SNRResult.center_frequency` | Computed |
| `bandwidth` | `float\|None` | `SNRResult.bandwidth` | Computed |
| `center_psd` | `float\|None` | `SNRResult.center_psd` | Computed |
| `mu_parameter` | `float\|None` | `SNRResult.mu_parameter` | Computed |
| `self_channel_interference_psd` | `float\|None` | `SNRResult.sci_psd` | Computed |
| `cross_channel_interference_psd` | `float\|None` | `SNRResult.xci_psd` | Computed |
| `length` | `float\|None` | **COMPUTED** | From path |
| `number_of_spans` | `int\|None` | **COMPUTED** | From path |
| `link_dictionary` | `dict\|None` | `NetworkState.link_info` | Network state |
| `modulation_format_mapping_dict` | `dict[int,str]` | `SimulationConfig.snr.mod_format_map` | Constant |
| `bandwidth_mapping_dict` | `dict[str,int]` | `SimulationConfig.snr.bandwidth_map` | Constant |
| `file_mapping_dict` | `dict` | `SimulationConfig.snr.precalc_files` | Configuration |

---

## 4. GroomingProps Field Mapping

Source: `fusion/core/properties.py` lines 298-318

| Legacy Field | Type | Destination | Rationale |
|-------------|------|-------------|-----------|
| `grooming_type` | `str\|None` | `SimulationConfig.features.grooming_type` | Configuration |
| `lightpath_status_dict` | `dict\|None` | `NetworkState.lightpaths` | Network state |

---

## 5. SDNProps Field Mapping (Detailed)

Source: `fusion/core/properties.py` lines 321-546

### 5.1 Network State Fields -> NetworkState (Phase 2)

| Legacy Field | Type | Destination | Notes |
|-------------|------|-------------|-------|
| `topology` | `Any` | `NetworkState.topology` | NetworkX graph |
| `network_spectrum_dict` | `dict` | `NetworkState.spectrum` | Core state |
| `lightpath_status_dict` | `dict` | `NetworkState.lightpaths` | LP storage |
| `transponder_usage_dict` | `dict` | `NetworkState.transponder_usage` | Resource tracking |
| `lp_bw_utilization_dict` | `dict` | `NetworkState.lp_utilization` | Utilization |
| `lightpath_counter` | `int` | `NetworkState._lp_counter` | ID generator |

### 5.2 Current Request Fields -> Request

| Legacy Field | Type | Destination | Notes |
|-------------|------|-------------|-------|
| `request_id` | `int\|None` | `Request.request_id` | Identifier |
| `source` | `str\|None` | `Request.source` | Origin node |
| `destination` | `str\|None` | `Request.destination` | Target node |
| `bandwidth` | `float\|None` | `Request.bandwidth_gbps` | Requested BW |
| `arrive` | `float\|None` | `Request.arrival_time` | Event time |
| `depart` | `float\|None` | `Request.departure_time` | Event time |
| `request_type` | `str\|None` | `Request.request_type` | arrival/release |
| `slots_needed` | `int\|None` | `Request.slots_needed` | Computed |
| `path_list` | `list\|None` | `Request.path` | Selected path |
| `path_index` | `int\|None` | `Request.path_index` | Path choice |
| `was_routed` | `bool\|None` | `Request.status` | Enum state |
| `was_groomed` | `bool\|None` | `Request.was_groomed` | Flag |
| `was_partially_groomed` | `bool` | `Request.was_partially_groomed` | Flag |
| `was_partially_routed` | `bool` | `Request.was_partially_routed` | Flag |
| `is_sliced` | `bool\|None` | `Request.is_sliced` | Flag |
| `block_reason` | `str\|None` | `Request.block_reason` | BlockReason enum |
| `remaining_bw` | `int\|float\|str\|None` | `Request.remaining_bandwidth` | Partial alloc |

### 5.3 Per-Request Tracking Lists -> AllocationResult

| Legacy Field | Type | Destination | Notes |
|-------------|------|-------------|-------|
| `bandwidth_list` | `list[float]` | `AllocationResult.bandwidth_allocations` | Sliced BWs |
| `modulation_list` | `list[str]` | `AllocationResult.modulations` | Per-segment |
| `core_list` | `list[int]` | `AllocationResult.cores` | Per-segment |
| `band_list` | `list[str]` | `AllocationResult.bands` | Per-segment |
| `crosstalk_list` | `list[float]` | `AllocationResult.xt_costs` | Per-segment |
| `snr_list` | `list[float]` | `AllocationResult.snr_values` | Per-segment |
| `xt_list` | `list[float]` | `AllocationResult.xt_values` | Per-segment |
| `start_slot_list` | `list[int]` | `AllocationResult.start_slots` | Per-segment |
| `end_slot_list` | `list[int]` | `AllocationResult.end_slots` | Per-segment |
| `lightpath_id_list` | `list[int]` | `AllocationResult.lightpath_ids` | Used LPs |
| `lightpath_bandwidth_list` | `list[float]` | `AllocationResult.lightpath_bandwidths` | LP BWs |

### 5.4 Configuration Fields -> SimulationConfig

| Legacy Field | Type | Destination | Notes |
|-------------|------|-------------|-------|
| `number_of_transponders` | `int\|None` | `SimulationConfig.topology.transponders` | Limit |
| `single_core` | `bool` | `SimulationConfig.topology.single_core` | Constraint |
| `modulation_formats_dict` | `dict\|None` | `SimulationConfig.modulation.formats` | Available mods |

### 5.5 Protection Fields -> Request + ProtectionResult

| Legacy Field | Type | Destination | Notes |
|-------------|------|-------------|-------|
| `primary_path` | `list\|None` | `Request.primary_path` | 1+1 primary |
| `backup_path` | `list\|None` | `Request.backup_path` | 1+1 backup |
| `is_protected` | `bool` | `Request.is_protected` | Protection flag |
| `active_path` | `str` | `Request.active_path` | "primary"/"backup" |
| `protection_switchover_ms` | `float` | `SimulationConfig.protection.switchover_ms` | Config |
| `restoration_latency_ms` | `float` | `SimulationConfig.protection.restoration_ms` | Config |
| `switchover_count` | `int` | `StatsCollector.switchover_count` | Statistic |
| `last_switchover_time` | `float\|None` | `Request.last_switchover_time` | Per-request |
| `recovery_start_time` | `float\|None` | `ProtectionResult.recovery_start` | Event time |
| `recovery_end_time` | `float\|None` | `ProtectionResult.recovery_end` | Event time |
| `recovery_type` | `str\|None` | `ProtectionResult.recovery_type` | protection/restoration |
| `allocated_requests` | `dict` | `NetworkState.allocated_requests` | State tracking |

### 5.6 Transient/Internal Fields -> DELETE or COMPUTED

| Legacy Field | Type | Destination | Notes |
|-------------|------|-------------|-------|
| `route_time` | `float\|None` | **COMPUTED** | Performance metric |
| `path_weight` | `float\|None` | **COMPUTED** | From path |
| `spectrum_object` | `SpectrumProps\|None` | **DELETE** | Nested props |
| `was_new_lp_established` | `list[int]` | `AllocationResult.new_lightpath_ids` | Temp tracking |
| `stat_key_list` | `list[str]` | **DELETE** | Internal |

---

## 6. StatsProps Field Mapping

Source: `fusion/core/properties.py` lines 549-612

| Legacy Field | Type | Destination | Notes |
|-------------|------|-------------|-------|
| `snapshots_dict` | `dict` | `StatsCollector.snapshots` | Periodic data |
| `cores_dict` | `dict[int,int]` | `StatsCollector.core_usage` | Core utilization |
| `weights_dict` | `dict` | `StatsCollector.path_weights` | Path lengths |
| `modulations_used_dict` | `dict` | `StatsCollector.modulation_counts` | Mod distribution |
| `bandwidth_blocking_dict` | `dict` | `StatsCollector.bandwidth_blocking` | Per-BW blocking |
| `link_usage_dict` | `dict` | `StatsCollector.link_usage` | Per-link stats |
| `demand_realization_ratio` | `dict` | `StatsCollector.demand_realization` | Success ratio |
| `frag_dict` | `dict` | `StatsCollector.fragmentation` | Spectrum frag |
| `lp_bw_utilization_dict` | `dict` | `StatsCollector.lp_utilization` | LP efficiency |
| `sim_lp_utilization_list` | `list[float]` | `StatsCollector.per_sim_lp_util` | Per-iteration |
| `block_reasons_dict` | `dict` | `StatsCollector.block_reasons` | Blocking causes |
| `simulation_blocking_list` | `list[float]` | `StatsCollector.blocking_probs` | Per-iteration BP |
| `simulation_bitrate_blocking_list` | `list[float]` | `StatsCollector.bitrate_blocking` | Per-iteration BBP |
| `transponders_list` | `list` | `StatsCollector.transponder_counts` | Per-iteration |
| `hops_list` | `list[float]` | `StatsCollector.hop_counts` | Path hops |
| `lengths_list` | `list[float]` | `StatsCollector.path_lengths` | Path km |
| `route_times_list` | `list[float]` | `StatsCollector.route_times` | Performance |
| `crosstalk_list` | `list[float]` | `StatsCollector.xt_values` | XT distribution |
| `snr_list` | `list[float]` | `StatsCollector.snr_values` | SNR distribution |
| `bands_list` | `list[int]` | `StatsCollector.band_usage` | Band distribution |
| `start_slot_list` | `list[int]` | `StatsCollector.start_slots` | Slot distribution |
| `end_slot_list` | `list[int]` | `StatsCollector.end_slots` | Slot distribution |
| `modulation_list` | `list[str]` | `StatsCollector.modulations` | Mod distribution |
| `bandwidth_list` | `list[float]` | `StatsCollector.bandwidths` | BW distribution |
| `path_index_list` | `list[int]` | `StatsCollector.path_indices` | Path choice dist |
| `protection_switchovers` | `int` | `StatsCollector.switchover_count` | Protection stats |
| `protection_failures` | `int` | `StatsCollector.protection_failures` | Protection stats |
| `failure_induced_blocks` | `int` | `StatsCollector.failure_blocks` | Failure stats |
| `switchover_times` | `list[float]` | `StatsCollector.switchover_times` | Event times |

---

## Summary Statistics

| Source Class | Total Fields | To Config | To Request | To Lightpath | To Results | To Stats | To NetworkState | Delete/Computed |
|-------------|--------------|-----------|------------|--------------|------------|----------|-----------------|-----------------|
| RoutingProps | 14 | 6 | 1 | 0 | 6 | 0 | 0 | 1 |
| SpectrumProps | 18 | 0 | 3 | 2 | 9 | 0 | 2 | 2 |
| SNRProps | 19 | 12 | 0 | 0 | 6 | 0 | 1 | 0 |
| GroomingProps | 2 | 1 | 0 | 0 | 0 | 0 | 1 | 0 |
| SDNProps | 47 | 6 | 17 | 0 | 12 | 1 | 6 | 5 |
| StatsProps | 26 | 0 | 0 | 0 | 0 | 26 | 0 | 0 |
| **Total** | **126** | **25** | **21** | **2** | **33** | **27** | **10** | **8** |

---

## Verification Matrix

For each legacy field, implementation must verify:
1. [ ] Field is mapped to exactly one destination (no duplicates)
2. [ ] Type is preserved or explicitly converted
3. [ ] Default value is preserved or documented change
4. [ ] All code accessing legacy field is updated
5. [ ] Legacy adapter provides round-trip conversion
6. [ ] Tests cover both new and legacy access patterns
