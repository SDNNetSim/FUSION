# P1.4 Result Objects - Index

**Sub-phase**: P1.4
**Scope**: Phase 1 - Core Domain Model only
**Goal**: Create frozen result dataclasses for all pipeline stages

---

## Objectives

1. Map current return structures (tuples/dicts) to typed result objects
2. Implement 6 frozen result dataclasses:
   - `RouteResult` - Routing pipeline output
   - `SpectrumResult` - Spectrum assignment output
   - `GroomingResult` - Grooming pipeline output
   - `SlicingResult` - Slicing pipeline output
   - `SNRResult` - SNR validation output
   - `AllocationResult` - Final orchestrator output
3. Define standard interfaces (success flags, block reasons)
4. Create comprehensive tests achieving 90% coverage

---

## Constraints

- **Additive only**: Do not modify any existing files
- **Frozen dataclasses**: All result objects are immutable after creation
- **AllocationResult is final authority**: `success` field determines request outcome
- **Block reason standardization**: Use `BlockReason` enum from P1.2
- **Composability**: Results can be nested in AllocationResult

---

## Micro-Tasks

| Task ID | File | Type | Description |
|---------|------|------|-------------|
| P1.4.a | [P1.4.a_design_route_result.md](P1.4.a_design_route_result.md) | design | Design RouteResult |
| P1.4.b | [P1.4.b_design_spectrum_result.md](P1.4.b_design_spectrum_result.md) | design | Design SpectrumResult |
| P1.4.c | [P1.4.c_design_grooming_slicing_results.md](P1.4.c_design_grooming_slicing_results.md) | design | Design GroomingResult and SlicingResult |
| P1.4.d | [P1.4.d_design_snr_result.md](P1.4.d_design_snr_result.md) | design | Design SNRResult |
| P1.4.e | [P1.4.e_design_allocation_result.md](P1.4.e_design_allocation_result.md) | design | Design AllocationResult (final authority) |
| P1.4.f | [P1.4.f_implement_all_results.md](P1.4.f_implement_all_results.md) | refactor-plan | Implement all result classes |
| P1.4.g | [P1.4.g_verify_results.md](P1.4.g_verify_results.md) | verification-plan | Create tests and verify |

---

## Shared Context

- [P1.4.shared_context_current_returns.md](P1.4.shared_context_current_returns.md) - Current return types inventory

---

## Dependencies

- P1.1 Domain Scaffolding (completed)
- P1.2 Request Wrapper (completed) - for `BlockReason` enum
- P1.3 Lightpath Wrapper (completed)

---

## Outputs

After completing all P1.4 micro-tasks:

```
fusion/
├── domain/
│   ├── __init__.py         # Updated: exports all result types
│   ├── config.py           # From P1.1
│   ├── request.py          # From P1.2
│   ├── lightpath.py        # From P1.3
│   └── results.py          # NEW: All result dataclasses
└── tests/
    └── domain/
        ├── __init__.py
        ├── test_config.py
        ├── test_request.py
        ├── test_lightpath.py
        └── test_results.py   # NEW: 90% coverage
```

---

## Result Object Hierarchy

```
RouteResult ─────────────┐
                         │
SpectrumResult ──────────┼──> AllocationResult (FINAL AUTHORITY)
                         │
GroomingResult ──────────┤
                         │
SlicingResult ───────────┤
                         │
SNRResult ───────────────┘
```

**Feasibility Chain**:
```
RouteResult.is_empty?
    │
    ├─Yes─> AllocationResult(success=False, block_reason=NO_ROUTE)
    │
    └─No──> SpectrumResult.is_free?
                │
                ├─No──> AllocationResult(success=False, block_reason=NO_SPECTRUM)
                │
                └─Yes─> SNRResult.passed?
                            │
                            ├─No──> AllocationResult(success=False, block_reason=SNR_FAILURE)
                            │
                            └─Yes─> AllocationResult(success=True, ...)
```

---

## Verification

After P1.4 is complete, verify:

```bash
# All tests pass
pytest fusion/tests/domain/test_results.py -v

# Coverage target met
pytest fusion/tests/domain/test_results.py --cov=fusion/domain/results --cov-report=term-missing

# Type checking passes
mypy fusion/domain/results.py

# Linting passes
ruff check fusion/domain/
ruff format --check fusion/domain/

# Existing tests still pass
pytest tests/ -v --ignore=fusion/tests/
```
