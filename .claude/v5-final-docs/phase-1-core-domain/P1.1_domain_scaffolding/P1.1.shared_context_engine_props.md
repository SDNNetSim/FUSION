# Shared Context: engine_props Structure

**Purpose**: Summarize the current `engine_props` dictionary structure for P1.1 tasks
**Source**: Extracted from `fusion/core/properties.py` and usage across the codebase

---

## engine_props Dictionary Structure

The `engine_props` dictionary is the primary configuration container passed throughout the FUSION simulation. Below is the complete field inventory.

### Network Topology Fields

```python
engine_props = {
    "topology": nx.Graph,              # NetworkX graph object (read-only after init)
    "topology_info": dict,             # Topology metadata (nodes, links, etc.)
    "network": str,                    # Network name ("USbackbone60", "NSFNET", etc.)
    "is_only_core_node": bool,         # If True, traffic only from core nodes
    "core_nodes": list[str],           # List of core node IDs (if not only_core_node)
}
```

### Traffic Parameters

```python
engine_props = {
    "num_requests": int,               # Total requests to generate
    "arrival_rate": float,             # Poisson arrival rate (requests/time unit)
    "holding_time": float,             # Mean request duration
    "request_distribution": dict[str, float],  # Bandwidth distribution percentages
    # Example: {"25": 0.3, "50": 0.4, "100": 0.3}
}
```

### Spectrum Configuration

```python
engine_props = {
    "band_list": list[str],            # Available bands: ["c"], ["c", "l"], ["c", "l", "s"]
    "cores_per_link": int,             # Number of cores in multi-core fiber
    "guard_slots": int,                # Guard band slots between allocations
    "allocation_method": str,          # "first_fit", "best_fit", "last_fit"
    "spectrum_priority": str,          # Band selection priority (e.g., "BSC")
    "fixed_grid": bool,                # Fixed vs flexible grid
    "multi_fiber": bool,               # Multi-fiber links enabled
}
```

### Band Slot Counts

```python
engine_props = {
    "c_band": int,                     # C-band slot count (e.g., 320)
    "l_band": int,                     # L-band slot count (e.g., 320)
    "s_band": int,                     # S-band slot count (e.g., 320)
}
```

### Routing Configuration

```python
engine_props = {
    "route_method": str,               # "k_shortest_path", "congestion_aware", etc.
    "k_paths": int,                    # Number of candidate paths to compute
}
```

### Feature Flags

```python
engine_props = {
    "is_grooming_enabled": bool,       # Traffic grooming enabled
    "max_segments": int,               # Max transponders per request (slicing)
    "snapshot_step": int,              # Stats collection interval
}
```

### SNR and Modulation

```python
engine_props = {
    "snr_type": str | None,            # "snr_e2e", "snr_segment", or None
    "mod_per_bw": dict[str, dict],     # Modulation formats per bandwidth
    # Example: {"50": {"QPSK": {...}, "16-QAM": {...}}, "100": {...}}
}
```

---

## Mapping to SimulationConfig

The `SimulationConfig` dataclass will organize these fields into logical groups:

| Legacy Field | SimulationConfig Field | Notes |
|--------------|------------------------|-------|
| `network` | `network_name` | Renamed for clarity |
| `cores_per_link` | `cores_per_link` | Direct mapping |
| `band_list` | `band_list` | Convert to tuple for immutability |
| `c_band`, `l_band`, `s_band` | `band_slots` | Combine into dict |
| `guard_slots` | `guard_slots` | Direct mapping |
| `num_requests` | `num_requests` | Direct mapping |
| `arrival_rate` * `holding_time` | `erlang` | Compute as product |
| `holding_time` | `holding_time` | Direct mapping |
| `route_method` | `route_method` | Direct mapping |
| `k_paths` | `k_paths` | Direct mapping |
| `allocation_method` | `allocation_method` | Direct mapping |
| `is_grooming_enabled` | `grooming_enabled` | Renamed (drop "is_" prefix) |
| `max_segments` | `max_slices` | Renamed for clarity |
| `snr_type` | `snr_type` | Direct mapping |
| `mod_per_bw` | `mod_per_bw` | Direct mapping |

---

## Fields NOT Included in SimulationConfig

The following fields remain in `engine_props` and are NOT part of `SimulationConfig`:

- `topology` - Mutable graph object, belongs in NetworkState
- `topology_info` - Derived from topology, computed on demand
- `request_distribution` - Traffic generation parameter, not simulation config

---

## Usage Patterns

### Current Pattern (legacy)

```python
def some_algorithm(engine_props: dict, ...):
    k = engine_props["k_paths"]
    method = engine_props["route_method"]
    ...
```

### Future Pattern (Phase 1)

```python
# During Phase 1, both patterns coexist
config = SimulationConfig.from_engine_props(engine_props)

# New code uses typed config
k = config.k_paths
method = config.route_method

# Legacy code still works (no changes required)
legacy_props = config.to_engine_props()
```

---

## Reference Files

For the complete source of truth, see:
- `fusion/core/properties.py` - EngineProps class definition
- `fusion/cli/run_sim.py` - CLI argument processing
- `fusion/configs/cli_to_config.py` - Configuration loading
