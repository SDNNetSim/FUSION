# P5.5 Orchestrator Integration

**Phase:** 5 - ML Control + Protection
**Sub-phase:** P5.5
**Scope:** Wire Policies and Protection into Orchestrator

---

## Goals

1. Integrate ControlPolicy into SDNOrchestrator
2. Create PolicyFactory for policy instantiation from config
3. Wire protection pipeline flows into orchestrator
4. Enable policy-based request handling
5. Integrate RLSimulationAdapter with policies

---

## Key Deliverables

| Deliverable | Description |
|-------------|-------------|
| `SDNOrchestrator` extension | Policy integration and arrival handling |
| `PolicyFactory` | Create policies from configuration |
| Protected flow wiring | Protection pipeline in orchestrator |
| `handle_arrival_with_policy` | Policy-based request processing |

---

## Constraints

- Must not break existing orchestrator functionality
- Policies must be optional (default to FirstFeasiblePolicy)
- Protection flows only active when enabled in config
- Must integrate with RLSimulationAdapter for PathOption generation

---

## Dependencies

| Dependency | From |
|------------|------|
| `ControlPolicy` protocol | P5.1 |
| Heuristic policies | P5.2 |
| `MLControlPolicy` | P5.3 |
| `ProtectionPipeline` | P5.4 |
| `RLSimulationAdapter` | Phase 4 |
| `SDNOrchestrator` | Phase 3 |

---

## Micro-Tasks

| Task ID | Type | Description | Output |
|---------|------|-------------|--------|
| P5.5.a | design | Design policy integration in orchestrator | Orchestrator extension |
| P5.5.b | design | Design PolicyFactory | Factory class |
| P5.5.c | wiring-plan | Wire policy to orchestrator | Integration code |
| P5.5.d | wiring-plan | Wire protection flows | Protection integration |
| P5.5.e | verification-plan | Create verification plan | Test suite |

---

## Exit Criteria

- [ ] SDNOrchestrator accepts ControlPolicy
- [ ] PolicyFactory creates all policy types
- [ ] handle_arrival_with_policy uses configured policy
- [ ] Protection pipeline integrated when enabled
- [ ] Fallback to default policy when none configured
- [ ] All tests pass

---

## Execution Order

```
P5.5.a (policy in orchestrator design)
    |
    +--> P5.5.b (PolicyFactory design)
    |
    v
P5.5.c (wire policy)
    |
    v
P5.5.d (wire protection)
    |
    v
P5.5.e (verification)
```

---

## Next Sub-Phase

After P5.5 completion, proceed to **P5.6 Configuration Extension** to add policy and protection configuration options.
